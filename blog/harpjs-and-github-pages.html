<!DOCTYPE html>
<html lang="en">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# website: http://ogp.me/ns/website#">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Making ideas happen, with JavaScript. We plan, design, and build modern, responsive HTML5 web and mobile applications. We specialize in rapid Minimum Viable Product development. We provide CTO consulting services.">
    <meta name="author" content="JJ Hiew">

    <meta property="og:title" content="A better way to deploy HarpJS compiled sites to Github Pages" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="//www.powderkeglabs.com/" />
    <meta property="og:image" content="//www.powderkeglabs.com//assets/images/backgrounds/development.jpeg" />
    <meta property="og:description" content="Making ideas happen, with JavaScript. We plan, design, and build modern, responsive HTML5 web and mobile applications. We specialize in rapid Minimum Viable Product development. We provide CTO consulting services." />
    <meta property="og:site_name" content="PowderKeg Labs" />

    <title>A better way to deploy HarpJS compiled sites to Github Pages</title>
    <link rel="stylesheet" href="/assets/components/prism/themes/prism.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

    <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  </head>

  <body>

    <nav class="dark-color" role="naviation">
  <div class="nav-wrapper container">
    <a href="/" class="brand-logo">
      <img src="/assets/images/powderkeg-logo.png" />
      <!-- img src="/assets/images/pkl-logo-header-orange.png" class="responsive-img" /-->
      <span class="full">PowderKeg Labs</span>
      <span class="small">PKL</span>
    </a>
    <ul class="right hide-on-med-and-down">
      <li><a href="/work.html">Case Studies</a></li>
      <li><a href="/about.html">Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/contact.html">Contact</a></li>
    </ul>

    <ul id="nav-mobile" class="side-nav">
      <li class="side-nav-brand flex">
        <a href="/"><img src="/assets/images/powderkeg-logo.png" class="responsive-img" /></a>
      </li>
      <li><a href="/work.html">Case Studies</a></li>
      <li><a href="/about.html">Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/contact.html">Contact</a></li>
    </ul>

    <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>

  </div>
</nav>


    
      
<header class="article" style="background-image: url(/assets/images/backgrounds/development.jpeg)">
  <div class="container">
    <div class="row">
      <div class="col s12 center-align flex">
      </div>
    </div>
  </div>
</header>


<main>
  <section class="article">
    <div class="container">
      <div class="col s12">
        <article>
          <h3>A better way to deploy HarpJS compiled sites to Github Pages</h3>
          <div class="article-meta">
              <time class="time">October 21, 2015</time>
          </div>
          <p>If you&#39;re publishing your HarpJS sites to Github pages, then you&#39;ve probably seen the Github deployment instructions in <a href="http://harpjs.com/docs/deployment/github-pages">the official HarpJS docs</a>.</p>
<p>If you&#39;re the kind of person that prefers using dependency managers (like Bower) to take care of your external assets, then you&#39;d have run into a hot mess using the &quot;official&quot; Github deployment approach.</p>
<h4>What mess?</h4><p>The Harp docs suggest putting your source files in a <code>_harp</code> folder under the project root.  Then to compile to static files, you&#39;d run...</p>
<pre><code class="language-bash">harp compile _harp ./
</code></pre>
<p>...which places the built files into root.  The problem is that <code>harp compile _harp ./</code> cleans out <em>everything</em> in the root directory save for the <code>_harp</code> folder and your <code>.git*</code> files (<code>bower.json</code>, <code>package.json</code>, and/or other config files).</p>
<h4>Solutions</h4><p>You can get around this in a few ways:</p>
<ol>
<li>utilize an orphaned <code>gh-pages</code> branch in the project repository; or</li>
<li>create two repositories - one for the source, one to publish the compiled site;</li>
</ol>
<p>Either way, you&#39;re doing the &quot;<code>cp -r</code> shuffle&quot; with files going back and forth between temp directories.  This is a major annoyance.</p>
<h4>The Better Way - Git Submodules</h4><p>Whoa, whoa, whoa!  Git Submodules, are you crazy?!  </p>
<p>Yes, I know <a href="http://slopjong.de/2013/06/04/git-why-submodules-are-evil/">how evil submodules</a> can be, but in this case they&#39;re a perfect solution. This post is actually inspired by <a href="http://blog.revathskumar.com/2014/07/publish-github-pages-using-git-submodules.html">Revath Kumar&#39;s post</a> on publishing to an orphan <code>gh-pages</code> branch on Github.  </p>
<h5>Let&#39;s Start</h5><p>For the sake of this tutorial, let&#39;s assume your git repo hasn&#39;t been initialized yet.</p>
<ol>
<li><p>Setup your repo at github initialize <code>master</code> on the remote branch</p>
</li>
<li><p>Create an orphan <code>gh-pages</code> branch</p>
<pre><code class="language-bash">$: git checkout --orphan gh-pages
</code></pre>
</li>
<li><p>If you run a <code>git status</code> you&#39;ll see all your files automatically staged for commit.  You <strong>don&#39;t</strong> want to commit these, so delete all the files save for the <code>.git*</code> ones.</p>
</li>
<li><p>Initialize the upstream <code>gh-pages</code> branch by pushing up an empty file.  This can be a <code>README</code> or whatever.  You might also need to run</p>
<pre><code class="language-bash">$: git push --set-upstream origin gh-pages
</code></pre>
</li>
<li><p>Switch back to your <code>master</code> branch</p>
<pre><code class="language-bash">$: git checkout master
</code></pre>
</li>
<li><p>Attach the <code>gh-pages</code> branch as a submodule to the Harp compile directory</p>
<pre><code class="language-bash">$: git submodule add -b gh-pages git@github.com:username/reponame.git www
</code></pre>
<p>We use <code>www</code> for the target directory for the compiled files because that&#39;s what <code>harp compile</code> defaults to. You can set <code>www</code> to whatever directory you want.</p>
</li>
<li><p>Now when you&#39;re in the <code>www</code> directory, you&#39;ll see that it&#39;s part of <code>gh-pages</code> branch.</p>
</li>
</ol>
<pre><code class="language-bash"># in project root directory
$: git status
On branch master

$: cd www
$: git status
On branch gh-pages
</code></pre>
<h4>Compiling and publishing to production</h4><p>Easy!</p>
<pre><code class="language-bash">$: harp compile

# static files will now be in /www
$: cd www

# /www is on branch gh-pages
$: git add .
$: git commit -m &quot;Message&quot;
$: git push origin gh-pages
</code></pre>
<p>Now take a look at the <code>gh-pages</code> branch on your Github repo and you should see your compiled code pushed.</p>
<p>Done.</p>
<h4>Protips</h4><p>These are mostly just stylistic / best practices...</p>
<ol>
<li><p>Use NPM to install HarpJS and Bower locally. This allows team members to spin up the project without the need for global dependencies.</p>
</li>
<li><p>Add a run script to your <code>package.json</code> file and use npm to compile for you.</p>
<pre><code class="language-js">// package.json
...
&quot;scripts&quot;: {
 &quot;compile&quot; : &quot;./node_modules/harp/bin/harp compile&quot;
}
</code></pre>
<p>Now you can run <code>$: npm run compile</code> to build your static files.</p>
</li>
</ol>
        </article>
      </div>
    </div>
  </section>

</main>

    

    <footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="white-text">Work With Us</h5>
        <p class="grey-text text-lighten-4"><a class="text-lighten-3" href="mailto:kaboom@powderkeglabs.com">kaboom@powderkeglabs.com</a></p>
      </div>
      <div class="col l4 offset-l2 s12">
        <h5 class="white-text">Links</h5>
        <ul>
          <li><a class="grey-text text-darken-1" href="/work.html">Case Studies</a></li>
          <li><a class="grey-text text-darken-1" href="/about.html">Our Team</a></li>
          <li><a class="grey-text text-darken-1" href="/blog">Blog</a></li>
          <li><a class="grey-text text-darken-1" href="/contact.html">Contact Us</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      <span class="grey-text">&copy; 2015 PowderKeg Labs</span>
    </div>
  </div>
</footer>


    <!-- Script Imports -->
    <!-- Custom Theme JavaScript -->
    <script src="/assets/components/jquery/dist/jquery.min.js"></script>
    <script src="/assets/components/Materialize/dist/js/materialize.min.js"></script>
    <script src="/assets/components/prism/prism.js"></script>
    <script src="/assets/components/prism/components/prism-bash.min.js"></script>
    <script src="/assets/js/main.js"></script>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-58016939-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
