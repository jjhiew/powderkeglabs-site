<!-- Polymer Imports -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-item/core-item.html">
<link rel="import" href="../../bower_components/core-icons/social-icons.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">

<!-- Custom Elements -->
<link rel="import" href="../services/nav-service.html">
<link rel="import" href="../site-footer/site-footer.html">

<polymer-element name="pkl-sidebar-layout" attributes="selected screenQuery toolbarTransparent bgImage bgRgba">

  <template>

    <!-- build:css sidebar-layout.css -->
    <link rel="stylesheet" href="sidebar-layout.css">
    <!-- endbuild-->

    <core-drawer-panel rightDrawer disableSwipe="true" responsiveWidth="9999px" id="drawerPanel">

      <core-header-panel drawer navigation flex mode="seamed">
        <core-toolbar>Powderkeg Labs</core-toolbar>

        <template repeat="{{navItem in navItems}}">
          <a active?="{{selected == navItem.hash}}" href="{{navItem.url}}">
            <core-item icon="{{navItem.icon}}" label="{{navItem.name}}"></core-item>
          </a>
        </template>

      </core-header-panel>

      <core-header-panel main id="mainPanel" mode="scroll" style="background-image: url('{{bgImage}}')">
        <core-toolbar id="mainHeader" transparent?={{toolbarTransparent}} style="background:rgba({{bgRgba}})">
          <div flex tool>
            <!-- <content select=".title"></content> -->
            <!-- PKL -->
            <a href="/#/"><core-icon class="top-logo" src="/images/pkl-logo-small.png"></core-icon></a>
          </div>

          <!-- Show links for larger screen sizes -->
          <div tool horizontal layout flex end-justified hidden?="{{smallScreen}}" class="large-screen-nav">
            <template repeat="{{navItem in navItems}}">
              <a active?="{{selected == navItem.hash}}" href="{{navItem.url}}" class="large-screen-nav__links">
                <core-item label="{{navItem.name}}"></core-item>
              </a>
            </template>
          </div>
          <!-- /Links for larger screen sizes -->

          <!-- Show menu button for smaller screen sizes -->
          <div tool hidden?="{{!smallScreen}}">
            <core-icon-button id="menuIconButton" icon="menu">
            </core-icon-button>
          </div>

          <!-- /Menu button for smaller screen sizes -->

        </core-toolbar>

        <content select=".content"></content>
        <pkl-site-footer navItems={{navItems}}></pkl-site-footer>

      </core-header-panel>
    </core-drawer-panel>

    <!-- Get the Nav Items -->
    <pkl-nav-service id="navService" navItems="{{navItems}}"></pkl-nav-service>
    <core-media-query query="{{screenQuery}}" queryMatches="{{smallScreen}}"></core-media-query>

  </template>
  <script>
    Polymer('pkl-sidebar-layout', {
      screenQuery: 'max-width: 800px',
      ready: function() {

        var menuIconButton = this.$.menuIconButton;
        var drawerPanel = this.$.drawerPanel;
        var mainPanel = this.$.mainPanel;
        var mainHeader = this.$.mainHeader;
        var mainHeaderHeight = 64; // Offsets for core-toolbar

        //Listen for a drawer panel toggle event
        menuIconButton.addEventListener('click', function(){
          drawerPanel.togglePanel();
        });

        //Listen for a 'scroll' event and scroll the screen to the specified y position.
        //For Polymer, it's the core-header-panel's scroller object that needs to scroll, not the <body>
        document.addEventListener('scroll-page-to', function(e){
          //console.log(mainHeader.get(0).offsetLeft);
          $(mainPanel.scroller).animate({
            scrollTop: e.detail.msg + mainHeaderHeight
          }, 1000);
        });

      }
    });
  </script>

</polymer-element>
